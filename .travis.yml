language: ruby
matrix:
  include:
    - rvm: 1.8.7
      gemfile: Gemfile-ruby1.8
      script: bundle exec rspec spec
      env: BUNDLE_GEMFILE=Gemfile-ruby1.8
    - rvm: 1.9.3
      gemfile: Gemfile
      script: bundle exec rspec spec
    - rvm: '2.0'
      gemfile: Gemfile
      script: bundle exec rspec spec
    - rvm: '2.1'
      gemfile: Gemfile
      script: bundle exec rspec spec
services:
- redis-server
before_install:
- gem --version
- wget http://s3.amazonaws.com/influxdb/influxdb_0.8.3_amd64.deb
- sudo dpkg -i influxdb_0.8.3_amd64.deb
- sudo sed -i 's/default-engine = "rocksdb"/default-engine = "leveldb"/' /opt/influxdb/versions/0.8.3/config.toml
- sudo sed -i 's/default-engine = "rocksdb"/default-engine = "leveldb"/' /opt/influxdb/shared/config.toml
- sudo /etc/init.d/influxdb start
- sleep 10
- 'curl -X POST ''http://localhost:8086/db?u=root&p=root'' -d ''{"name": "sandstorm_test"}'''
- 'curl -X POST ''http://localhost:8086/db/sandstorm_test/users?u=root&p=root'' -d
  ''{"name": "sandstorm", "password": "sandstorm"}'''
- 'curl -X POST ''http://localhost:8086/db/sandstorm_test/users/sandstorm?u=root&p=root''
  -d ''{"admin": true}'''
notifications:
  hipchat:
    template:
    - '%{repository}#%{build_number} (%{branch} - %{commit} : %{author}): %{message}
      (<a href="%{build_url}">Details</a>/<a href="%{compare_url}">Change view</a>)'
    format: html
    rooms:
      secure: GrQkFR0osJal/ciXSMydKYoQFzNwSxJCtWcaZtUgxEjba+xYbNEmT/RiRpq0MhGTAn5DUEcqHKENC0qVOxiBp8WPkCzcDLjmDzTpci1QDelB0faORfG8/71JpkrOoSvWzqg0QU3H4OgQaROE9mq3MdjYml6bH3M1ZtWSArX257Y=
